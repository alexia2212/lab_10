<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
    <title>Juego de la memoria</title>
    <style>
        .block {
            background-color: #49BCD4;
            border: 1px solid black;
            width: 250px;
            height: 250px;
            margin-bottom: 20px;
            display: inline-block;
        }

        .image-item {
            position: relative;
            display: inline-block;
        }

        .close-button {
            position: absolute;
            top: 5px;
            right: 5px;
            cursor: pointer;
            padding: 2px 5px;
            border-radius: 50%;
        }
    </style>
</head>
<body>
<h1>El Juego de la Memoria</h1>

<h5>Total de imágenes seleccionadas: <span id="imageCount">0</span></h5>

<label for="inputFile" class="btn btn-success">Cargar imágenes</label>
<input type="file" id="inputFile" accept="image/png" multiple style="display: none">

<div id="imageContainer">
    <div id="gameBoard"></div>
</div>

<button onclick="generarCuadro()">Agregar Tablero</button>
<div id="container"></div>

<button id="Aleatorizar" type="button" class="btn btn-danger">Aleatorizar</button>

<script>
    function generarCuadro() {
        var imagenes = document.getElementById('imageContainer').getElementsByTagName('img');
        var numImagenes = imagenes.length;

        var numCols = 3; // Número de columnas deseado
        var numRows = Math.ceil(numImagenes / numCols); // Calcular el número de filas

        var container = document.getElementById('container');
        container.innerHTML = ''; // Limpiar el contenido actual

        for (var i = 0; i < numRows; i++) {
            var row = document.createElement('div');
            row.className = 'row';

            for (var j = 0; j < numCols; j++) {
                var imgIndex = i * numCols + j;
                if (imgIndex < numImagenes) {
                    var img = imagenes[imgIndex].cloneNode(true);
                    var block = document.createElement('div');
                    block.style.backgroundImage = img;
                    block.style.backgroundSize = "190px 200px";
                    block.className = 'block';
                    block.appendChild(img);
                    row.appendChild(block);
                }
            }

            container.appendChild(row);
        }
    }

    document.getElementById('inputFile').addEventListener('change', loadImages);

    function loadImages() {
        var filesInput = document.getElementById('inputFile');
        var files = filesInput.files;
        var imageContainer = document.getElementById('imageContainer');
        var imageCount = document.getElementById('imageCount');

        if (imageCount.textContent >= 15) {
            alert('Solo se aceptan 15 imágenes');
            return;
        }

        for (var i = 0; i < files.length; i++) {
            var file = files[i];

            if (!file.type.match('image.*')) {
                continue;
            }

            var reader = new FileReader();
            reader.onload = (function (aFile) {
                return function (e) {
                    var imgContainer = document.createElement('div');
                    imgContainer.classList.add('image-item');

                    var closeButton = document.createElement('span');
                    closeButton.classList.add('close-button');
                    closeButton.innerHTML = '&times;';
                    closeButton.onclick = function() {
                        deleteImage(imgContainer);
                    };

                    var img = document.createElement('img');
                    img.classList.add('thumbnail');
                    img.style.width = "190px";
                    img.style.height = "200px";
                    img.src = e.target.result;

                    imgContainer.appendChild(closeButton);
                    imgContainer.appendChild(img);
                    imageContainer.appendChild(imgContainer);
                    imageCount.textContent = parseInt(imageCount.textContent) + 1;
                };
            })(file);

            reader.readAsDataURL(file);
        }
    }

    function deleteImage(imageContainer) {
        var imageCount = document.getElementById('imageCount');
        imageCount.textContent = parseInt(imageCount.textContent) - 1;
        imageContainer.parentNode.removeChild(imageContainer);
    }


    document.getElementById('Aleatorizar').addEventListener('click', aleatorizar);

    function aleatorizar() {
        var blocks = document.getElementsByClassName('block');
        var imageArray = [];

        for (var i = 0; i < blocks.length; i++) {
            var block = blocks[i];
            var img = block.getElementsByTagName('img')[0];
            imageArray.push(img);
        }

        shuffleArray(imageArray); // Aleatorizar las imágenes

        for (var i = 0; i < blocks.length; i++) {
            var block = blocks[i];
            var img = imageArray[i].cloneNode(true);
            block.innerHTML = '';
            block.style.backgroundImage = 'url(' + img.src + ')';
            block.appendChild(img);
        }
    }

    function shuffleArray(array) {
        var currentIndex = array.length;
        var temporaryValue, randomIndex;

        while (currentIndex !== 0) {
            randomIndex = Math.floor(Math.random() * currentIndex);
            currentIndex -= 1;

            temporaryValue = array[currentIndex];
            array[currentIndex] = array[randomIndex];
            array[randomIndex] = temporaryValue;
        }

        return array;
    }
</script>
</body>
</html>
