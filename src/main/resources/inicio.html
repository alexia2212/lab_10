<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
    <title>Juego de la memoria</title>
</head>
<body>

<h1>El Juego de la Memoria</h1>

<h5>Total de imágenes seleccionadas: <span id="imageCount">0</span></h5>

<form id="myForm">
    <input type="file" id="myFile" name="myFile" accept="image/png">
    <button type="submit" class="btn btn-success">Subir imagen</button>
</form>

<div id="imageContainer"></div>

<script>
    document.getElementById('myForm').addEventListener('submit', function(e) {
        e.preventDefault();

        var fileInput = document.getElementById('myFile');
        var file = fileInput.files[0];

        if (!file || file.type !== 'image/png') {
            console.error('Se aceptan solo archivos png.');
            return;
        }

        var formData = new FormData();
        formData.append('image', file);

        fetch('/http://localhost:8080', {
            method: 'POST',
            body: formData
        })
            .then(function(response) {
                return response.blob();
            })
            .then(function(blob) {
                var imageUrl = URL.createObjectURL(blob);

                var img = document.createElement('img');
                img.src = imageUrl;

                var closeBtn = document.createElement('span');
                closeBtn.className = 'close-button w3-button w3-display-topright';
                closeBtn.innerHTML = '&times;';

                var imageContainer = document.getElementById('imageContainer');
                imageContainer.appendChild(img);
                imageContainer.appendChild(closeBtn);

                // Incrementar el contador de imágenes
                var imageCount = document.getElementById('imageCount');
                imageCount.textContent = parseInt(imageCount.textContent) + 1;

                URL.revokeObjectURL(imageUrl);
            })
            .catch(function(error) {
                console.error('Error al subir la imagen', error);
            });
    });

    document.addEventListener('click', function(e) {
        if (e.target.classList.contains('close-button')) {
            var imageContainer = e.target.parentNode;
            var imageCount = document.getElementById('imageCount');
            imageCount.textContent = parseInt(imageCount.textContent) - 1;
            imageContainer.parentNode.removeChild(imageContainer);
        }
    });
</script>
</body>
</html>